<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Y2K Drip Store</title>
<style>
:root{
  --dark-green:#064420; 
  --dark-red:#4e0000; 
  --white:#fff;
  --accent:#00ff7f;
}
html,body{
  height:100%; margin:0; font-family:Arial,sans-serif; color:var(--white);
  background: linear-gradient(270deg,var(--dark-green),var(--dark-red),var(--dark-green));
  background-size: 600% 600%;
  animation: gradientShift 3s ease infinite;
  overflow-x:hidden;
}
@keyframes gradientShift{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
.wrap{width:100%; max-width:1200px; margin:0 auto;}
@media(max-width:480px){.wrap{max-width:420px;}}
header{background:#000; border-bottom:3px solid #8b0000; padding:12px 16px; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap;}
header h1{font-size:24px; color:var(--accent); margin:0;}
nav ul{list-style:none; margin:0; padding:0; display:flex; gap:10px; flex-wrap:wrap;}
nav a{color:#fff; text-decoration:none; font-weight:bold; padding:6px 10px; border-radius:6px;}
nav a:hover{background:var(--accent); color:#000;}
.search-bar{padding:12px; display:flex; justify-content:center; gap:8px; background:rgba(0,0,0,.55);}
.search-bar input{width:60%; max-width:320px; padding:10px; border:0; border-radius:8px;}
.search-bar button{padding:10px 14px; border:0; border-radius:8px; cursor:pointer;
  background:linear-gradient(90deg,var(--dark-red),var(--dark-green));
  background-size:200% 200%; animation:gradientShift 3s ease infinite; color:#fff;}
.banner{height:260px; display:flex; align-items:center; justify-content:center; text-align:center;
  padding:16px; font-size:28px; font-weight:800; text-shadow:2px 2px 6px rgba(0,0,0,.5); background:rgba(0,0,0,.15);}
.tabs{margin:12px auto 0; padding:0 12px;}
.tab-row{display:flex; gap:8px; flex-wrap:wrap; justify-content:center;}
.tab{background:#000; border:1px solid rgba(255,255,255,.15); padding:8px 12px; border-radius:20px; font-size:13px; cursor:pointer;}
.tab.active{background:var(--accent); color:#000;}
.grid{display:flex; flex-direction:column; gap:10px; padding:12px;}
.grid-row{display:flex; gap:10px; flex-wrap:wrap;}
.card{background: rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.12); border-radius:12px; overflow:hidden; flex:1 1 calc(50% - 10px);}
.thumb{width:100%; aspect-ratio:1/1; background:#111; object-fit:cover; display:block;}
.info{padding:10px;}
.name{font-weight:700; font-size:14px; margin:0 0 6px;}
.sizes{font-size:12px; opacity:.85;}
.price{margin-top:8px; font-weight:800;}
.add-cart{margin-top:8px;padding:6px 10px;width:100%;border:none;border-radius:6px;background:var(--accent);color:#000;font-weight:bold;cursor:pointer;}
.add-cart:hover{background:#00cc66;}
.ad-banner{width:100%; height:10vh; background:linear-gradient(90deg,#ff0000,#ff7f00); display:flex; justify-content:center; align-items:center; color:#fff; font-weight:bold; margin:10px 0; border-radius:12px;}
.loading,.error{padding:20px; text-align:center; font-weight:700;}
footer{background:#000; border-top:3px solid #8b0000; padding:18px; text-align:center; color:#ccc;}
#cartBtn{position:fixed; bottom:20px; right:20px; width:60px; height:60px; background:var(--accent);
  color:#000; border-radius:50%; display:flex; justify-content:center; align-items:center;
  font-weight:bold; font-size:18px; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.3); z-index:9999;}
#cartPanel{position:fixed; bottom:90px; right:20px; width:300px; max-height:400px; overflow-y:auto;
  background:rgba(0,0,0,0.9); color:#fff; border-radius:12px; padding:12px; display:none; z-index:9998;}
#cartPanel h3{margin-top:0;}
.cart-item{border-bottom:1px solid #555; padding:6px 0;}
</style>
</head>
<body>

<header class="wrap">
<h1>Y2K Drip Store</h1>
<nav>
<ul>
<li><a href="#">Men's Clothing</a></li>
<li><a href="#">Women's Clothing</a></li>
<li><a href="#">Kids Clothing</a></li>
<li><a href="#">Boys Clothing</a></li>
<li><a href="#">Girls Clothing</a></li>
<li><a href="#">Sneakers</a></li>
<li><a href="#">iPhones</a></li>
<li><a href="#">Laptops</a></li>
<li><a href="#">Jewelry</a></li>
</ul>
</nav>
</header>

<div class="search-bar wrap">
<input id="search" type="text" placeholder="Search for products..."/>
<button id="searchBtn">Search</button>
</div>

<div class="banner wrap">Welcome to Y2KDRIPSTORE</div>
<div class="ad-banner" id="topAd">Advertisement</div>

<section class="tabs wrap">
<div class="tab-row" id="tabRow"></div>
</section>

<main class="wrap" id="content">
<div id="status" class="loading">Loading productsâ€¦</div>
<div id="grid" class="grid" hidden></div>
</main>

<div id="cartBtn">Cart ðŸ›’</div>
<div id="cartPanel">
<h3>Your Cart</h3>
<div id="cartItems">No items yet</div>
</div>

<footer>&copy; Y2KDRIPSTORE 2025 @ Reserved</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyCCf-NoeTqAd2ZMUxH118WTVkHfWtwybno",
authDomain: "y2kdripstore-cf955.firebaseapp.com",
projectId: "y2kdripstore-cf955",
storageBucket: "y2kdripstore-cf955.firebasestorage.app",
messagingSenderId: "463524157257",
appId: "1:463524157257:web:d385bf676cbbb77f042c98",
measurementId: "G-DYK3Y1Z492"
};
const app = initializeApp(firebaseConfig);
getAnalytics(app);
const db = getFirestore(app);

const SHEET_ID = '1K3RwSQVH2x60mFaNo5DCFY8jtncU2CaVOjovTtuB4dU';
const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;
const FX_KEY = '88d799cb628598ac17f47565';
const FX_URL = `https://v6.exchangerate-api.com/v6/${FX_KEY}/latest/ZAR`;

function guessCurrency(){
  const locale = (navigator.languages && navigator.languages[0]) || navigator.language || 'en-ZA';
  const region = (locale.split('-')[1] || 'ZA').toUpperCase();
  const map = { ZA:'ZAR', US:'USD', GB:'GBP', EU:'EUR', DE:'EUR', FR:'EUR', IT:'EUR', ES:'EUR', PT:'EUR', IE:'EUR', NL:'EUR', BE:'EUR', AT:'EUR', FI:'EUR', GR:'EUR', SK:'EUR', SI:'EUR', EE:'EUR', LV:'EUR', LT:'EUR', CY:'EUR', LU:'EUR', MT:'EUR',
  CA:'CAD', AU:'AUD', NZ:'NZD', JP:'JPY', CN:'CNY', HK:'HKD', SG:'SGD', IN:'INR', NG:'NGN', KE:'KES', TZ:'TZS', MZ:'MZN', BW:'BWP', NA:'NAD', ZM:'ZMW', ZW:'ZWL',
  AE:'AED', SA:'SAR', QA:'QAR', KW:'KWD', BH:'BHD'};
  return map[region]||'ZAR';
}

let TARGET_CCY = guessCurrency();
let rates = {ZAR:1};
const CATEGORIES = ['MENS CLOTHING','WOMEN CLOTHING','KIDS CLOTHING','BOYS CLOTHING','GIRLS CLOTHING','SNEAKERS','IPHONES','LAPTOPS','JEWELRY'];
const tabRow = document.getElementById('tabRow');
const grid = document.getElementById('grid');
const statusEl = document.getElementById('status');
let allRows = [];
let byCat = {};

function formatMoney(amount, ccy){
  try{ return new Intl.NumberFormat(undefined,{style:'currency',currency:ccy}).format(amount);}
  catch(e){ return amount.toFixed(2)+' '+ccy;}
}

function buildTabs(active){
  tabRow.innerHTML='';
  CATEGORIES.forEach(cat=>{
    const b=document.createElement('button');
    b.className='tab'+(cat===active?' active':'');
    b.textContent=cat;
    b.addEventListener('click',()=>selectCategory(cat));
    tabRow.appendChild(b);
  });
}

function renderProductsWithAds(items){
  grid.innerHTML='';
  const chunkSize=2;
  for(let i=0;i<items.length;i+=chunkSize){
    const chunk=items.slice(i,i+chunkSize);
    const rowDiv=document.createElement('div');
    rowDiv.className='grid-row';
    chunk.forEach(p=>{
      const card=document.createElement('div'); card.className='card';
      const img=document.createElement('img'); img.className='thumb'; img.loading='lazy'; img.alt=p.Name; img.src=p.Image;
      const info=document.createElement('div'); info.className='info';
      const name=document.createElement('p'); name.className='name'; name.textContent=p.Name;
      const sizes=document.createElement('p'); sizes.className='sizes'; sizes.textContent=p.Sizes ? `Sizes: ${p.Sizes}` : '';
      const price=document.createElement('div'); price.className='price';
      const zar=Number(p.Price||0); const fx=rates[TARGET_CCY]||1;
      price.textContent=formatMoney(zar*fx,TARGET_CCY);
      const addBtn=document.createElement('button'); addBtn.className='add-cart'; addBtn.textContent='Add to Cart';
      addBtn.addEventListener('click',()=>addToCart(p));
      info.appendChild(name); info.appendChild(sizes); info.appendChild(price); info.appendChild(addBtn);
      card.appendChild(img); card.appendChild(info);
      rowDiv.appendChild(card);
    });
    grid.appendChild(rowDiv);
    // Insert ad after each chunk
    const adDiv=document.createElement('div'); adDiv.className='ad-banner'; adDiv.textContent='Advertisement';
    grid.appendChild(adDiv);
  }
}

function selectCategory(cat){
  buildTabs(cat);
  const items=byCat[cat]||[];
  statusEl.hidden=true; grid.hidden=false;
  renderProductsWithAds(items);
}

async function load(){
  try{
    // fetch rates
    const fxRes=await fetch(FX_URL); const fxJson=await fxRes.json();
    if(fxJson&&fxJson.conversion_rates) rates=fxJson.conversion_rates;
    // fetch sheet
    const res=await fetch(SHEET_CSV_URL);
    if(!res.ok) throw new Error('Sheet not reachable');
    const csv=await res.text();
    const rows=parseCSV(csv);
    const headers=rows.shift().map(h=>h.trim());
    const idx={ Name: headers.indexOf('Name'), Price: headers.indexOf('Price'), Image: headers.indexOf('Image'), Sizes: headers.indexOf('Sizes'), Category: headers.indexOf('Category') };
    allRows=rows.map(r=>({ Name:r[idx.Name]?.trim()||'', Price:r[idx.Price]?.trim()||'', Image:r[idx.Image]?.trim()||'', Sizes:r[idx.Sizes]?.trim()||'', Category:(r[idx.Category]?.trim()||'').toUpperCase() })).filter(x=>x.Name && x.Image);
    byCat={}; CATEGORIES.forEach(c=>byCat[c]=[]); allRows.forEach(p=>{ if(byCat[p.Category]) byCat[p.Category].push(p); });
    const firstWithItems=CATEGORIES.find(c=>(byCat[c]&&byCat[c].length));
    if(firstWithItems) selectCategory(firstWithItems); else statusEl.textContent='No products yet';
  }catch(err){ console.error(err); statusEl.className='error'; statusEl.textContent='Error loading data';}
}

function parseCSV(text){
  const rows=[]; let cur=[]; let val=''; let inQ=false;
  for(let i=0;i<text.length;i++){ const c=text[i]; const n=text[i+1];
    if(c==='"'){ if(inQ && n==='"'){ val+='"'; i++; } else { inQ=!inQ; } }
    else if(c===',' && !inQ){ cur.push(val); val=''; }
    else if((c==='\n'||c==='\r')&&!inQ){ if(val!==''||cur.length){ cur.push(val); rows.push(cur); cur=[]; val=''; } }
    else{ val+=c; }
  }
  if(val!==''||cur.length){ cur.push(val); rows.push(cur); }
  return rows;
}

// --- Search ---
document.getElementById('searchBtn').addEventListener('click',()=>{
  const q=document.getElementById('search').value.toLowerCase();
  const match=allRows.filter(p=>(p.Name||'').toLowerCase().includes(q));
  statusEl.hidden=true; grid.hidden=false;
  buildTabs('');
  renderProductsWithAds(match);
});

// --- Cart ---
const cartBtn=document.getElementById('cartBtn');
const cartPanel=document.getElementById('cartPanel');
const cartItemsDiv=document.getElementById('cartItems');

cartBtn.addEventListener('click',()=>{ cartPanel.style.display=cartPanel.style.display==='block'?'none':'block'; });

function addToCart(product){
  addDoc(collection(db,'cart'),{name:product.Name,price:product.Price,image:product.Image,timestamp:Date.now()});
}

onSnapshot(collection(db,'cart'),snapshot=>{
  if(snapshot.empty){ cartItemsDiv.textContent='No items yet'; return; }
  cartItemsDiv.innerHTML='';
  snapshot.forEach(doc=>{
    const data=doc.data();
    const div=document.createElement('div'); div.className='cart-item';
    div.textContent=`${data.name} - ${TARGET_CCY==='ZAR'?data.price:formatMoney(Number(data.price)*rates[TARGET_CCY],TARGET_CCY)}`;
    cartItemsDiv.appendChild(div);
  });
});

load();
</script>
</body>
            </html>
